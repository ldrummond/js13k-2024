function l(a){return Math.round(Math.random()*a)}function n(a,d=10){let [b,c,e]=a;return`hsl(${b+(Math.random()-.5)*d},${c+(Math.random()-.5)*d}%,${e+(Math.random()-.5)*d}%)`}function p(a){let d=a.cloneNode(),b=d.getContext("2d");b.drawImage(a,0,0);b.imageSmoothingEnabled=!1;return[d,b]}function t(a){let d=document.createElement("a");d.innerHTML=a;return d.children[0]}
function u(a,d,b,c){(1>a.width||1>a.height)&&console.log("Failed to replace color");a=d.getImageData(0,0,a.width,a.height);let e=a.data;for(let f=0;f<e.length;f+=4)e.slice(f,f+3)+""==b+""&&(e[f]=c[0],e[f+1]=c[1],e[f+2]=c[2]);d.putImageData(a,0,0)}
function v(a,d,b,c,e,f,k=12,g,m){m=m||x;c=Math.ceil(c/m);e=Math.ceil(e/m);let q=(g||1)/m,w=!g;w&&(a.fillStyle=n(f,0),a.fillRect(d||0,b||0,Math.ceil((c+1)*m),Math.ceil((e+1)*m)));for(let h=0;h<=c;h++)for(let r=0;r<=e;r++){let A=h<=q||h>=c-q||r<=q||r>=e-q;if(w||A){let R=.75<Math.random(),S=k;g&&(S=R?k:0);if(R||g&&A)a.fillStyle=n(f,S),a.fillRect(h*m+d,r*m+b,m,m)}}}
function aa(a){console.log("Sprite Text Init Src: INNER: ",a);console.log("canvas from spritesheet",a,y.width,y.height,void 0,void 0);let [d,b]=p(y),c=a.w,e=a.h;d.width=c;d.height=e;b.drawImage(z,a.x,a.y,a.w,a.h,0,0,c,e);return[d,b]}Array.prototype.g=0;Array.prototype.next=function(){this.g=(this.g+1)%this.length;return this[this.g]};
let ba=[0,0,1],B=[0,0,19],ca=[0,0,20],ea=[8,65,15],fa=[0,0,28],ha=[230,80,40],ia=[3,3,3],ja=[255,255,255],ka=[155,132,2],C=[93,52,52],D=[180,49,67],E=window.devicePixelRatio||1,F=window.innerWidth,G=window.innerHeight,la=[392,329.63,293.66,246.94,220,196],z=document.createElement("img");z.src="spritesheet.png";let ma=12/9,[H,I]=F/ma>G?[G*ma,G]:[F,F/ma],x=H/300,J=3*I/24,K=21*I/24/x,L=(1*H/24+20)/x,M=(24*H/24-L)/4/x,y=document.createElement("canvas");y.width=F;y.height=G;let [N,na]=p(y);N.id="loading";
N.classList.add("fill");document.body.append(N);v(na,0,0,F,G,ba);na.imageSmoothingEnabled=!1;let O=document.createElement("div");O.style.width=H+"px";O.style.height=I+"px";O.id="container";O.innerHTML='<div id="text"></div><div id="footer"></div>';document.body.prepend(O);let [P,Q]=p(y);P.id="main";O.append(P);P.width=H*E;P.height=I*E;Q.scale(E,E);Q.imageSmoothingEnabled=!1;document.documentElement.style.fontSize=4*x+"px";let [oa]=p(P);
var pa="",qa=void 0,ra=0,sa=0,ta=1,ua="default",va=[],T=[],wa=[];
let xa={name:"hormones",type:0,icon:'<path d="M35 32.6C35 38.4 30.5 43 25 43s-10-4.6-10-10.4c0-1.3.6-3.6 1.7-6.4a118.9 118.9 0 0 1 7.5-16.5l.8-1.6a240.8 240.8 0 0 1 8.3 18c1 2.9 1.7 5.2 1.7 6.5Z"/>',i:0,H:100,D:0,P:!1,R:()=>!0},ya={name:"confidence",type:1,icon:'<path d="m22 9 8 3c3 1 6 3 7 5 5 8 3 18-4 22-3 2-7 2-10 2a16 16 0 0 1-8-30 21 21 0 0 1 7-2Z"/><circle cx="27.1" cy="24" r="16"/><path d="M27 8v31M38 24a21 21 0 0 1-3 2c-2 1-5 3-8 3s-6-2-8-3a23 23 0 0 1-3-2 20 20 0 0 1 3-2c2-1 5-3 8-3s6 2 8 3a23 23 0 0 1 3 2Z"/><ellipse cx="26.9" cy="24.1" rx="2.8" ry="4.7"/>',i:0,
H:10,D:0,P:!0,R:()=>!1},za={name:"maturity",type:2,icon:'<path d="m20.4 23.5-9-3.7 7.3-12 1.3 7.4v.7l.7.1L32 19.5l-2.9 7.9-.4 1 1 .3 9 2.7L35 44H22.9l2.7-7.7.3-.9-.9-.3-7-2.7 3-7.6.3-1-1-.3Z"/>',i:0,H:20,D:0,P:!0,R:()=>!1},Aa={name:"knowledge",type:3,icon:'<rect width="24" height="8" x="7" y="8" rx="4"/><path d="M13 8h21a4 4 0 0 1 4 4v26a4 4 0 0 1-4 4H17a4 4 0 0 1-4-4V8Z"/><path d="M18 34h21a4 4 0 0 1 0 8H18v-8Z"/><path d="M17 42a4 4 0 0 0 0-8m-4-22c0-2.2-.9-4-2-4"/><circle cx="17" cy="38" r="3"/>',
i:0,H:5,D:0,P:!0,R:()=>!1},Ba=[xa,za,ya,Aa],U={[0]:xa,[2]:za,[1]:ya,[3]:Aa};function Ca(a){return t(`<svg viewBox='0 0 50 50'>${a}</svg>`)}function Da(a,d,b){a=Ca(U[a].icon);let c=t("<div class='resource-gain'></div>");c.append(a);c.style.left=d+"px";c.style.top=b+"px";O.append(c);setTimeout(()=>{c.remove()},2E3)}
class Ea{constructor(a,d,b){this.g=0;this.G=a;this.m=d;this.s=b;wa.push(this)}J(a){0!=this.m&&(this.g+=a,this.g>=this.G&&(this.s&&this.s(this.m),this.m--,0!=this.m?this.g=0:this.cancel()))}cancel(){let a=wa.indexOf(this);-1<a&&wa.splice(a,1)}}
class Fa{constructor(a){this.data={};let {id:d,x:b,y:c,w:e,M:f,j:k,$:g,data:m}=a;this.id=d||l(100)+"";this.data=m;let q=k[0];this.x=b*x;this.y=c*x;this.w=e*x;let w=this.w/q.w;this.g=q.h/q.w*this.w;this.G=k.map(h=>{let [r,A]=aa(h);document.body.append(r);f&&(this.w*=2,this.w+=f*w,r.width*=2,r.width+=f);let R=h.x,S=h.y,da=h.w;h=h.h;a.M&&(A.drawImage(z,R,S,da,h,0,0,da,h),A.save(),A.scale(-1,1),A.translate(-r.width,0),A.drawImage(z,R,S,da,h,0,0,da,h),A.restore());return[r,A]}).map(h=>h[0]);this.V=this.G[0];
g&&new Ea(g,-1,()=>{this.V=this.G.next()})}K(a){a.drawImage(this.V,this.x,this.y,this.w,this.g)}}let Ga=oa.getContext("2d",{ca:!0}),Ha=oa.getBoundingClientRect();Ga.scale(E,E);O.prepend(oa);oa.style.opacity="0";function Ia(){let a=Ga.getImageData((ra-Ha.left)*E,(sa-Ha.top)*E,1,1).data;pa=`rgb(${a[0]},${a[1]},${a[2]})`}
function Ja(a){a.G.map(d=>{let [b,c]=p(d),e={};e.aa=d;c.globalCompositeOperation="source-over";c.fillStyle=a.X;c.fillRect(0,0,a.w,a.g);c.globalCompositeOperation="destination-in";c.drawImage(d,0,0);var f=a.x,k=a.y,g=a.w,m=a.g;console.log("Add to hitmask");Ga.drawImage(b,f,k,g,m);c.globalCompositeOperation="source-atop";c.drawImage(d,0,0);document.body.append(d);u(b,c,C,D);e.O=p(b)[0];u(b,c,D,C);document.body.append(e.O);c.fillStyle="rgba(0,0,0,0.5)";c.fillRect(0,0,a.w,a.g);e.N=p(b)[0];document.body.append(e.N);
c.fillStyle="rgba(0,0,0,0.7)";c.fillRect(0,0,a.w,a.g);e.U=p(b)[0];document.body.append(e.U);c.drawImage(d,0,0);u(b,c,C,D);c.fillStyle="rgba(255,200,200,0.6)";c.fillRect(0,0,a.w,a.g);e.Z=p(b)[0];u(b,c,D,C);c.clearRect(0,0,a.w,a.g);c.globalCompositeOperation="source-over";c.drawImage(d,0,0);a.S.push(e)})}
class Ka extends Fa{constructor(a){let {name:d,description:b,l:c,state:e,A:f,gain:k,F:g,C:m,o:q,hidden:w=!1,B:h}=a;super(q);this.S=[];this.Y=this.W=0;this.B=this.s=this.I=this.T=this.F=!1;this.name=d;this.description=b;this.l=c;this.state=e;this.A=f;this.gain=k;this.F=!!g;this.L=m;this.o=q;this.X=`rgb(${l(255)},${l(255)},${l(255)})`;this.hidden=w;this.B=h;Ja(this);this.v=this.S[0]}J(){var a=Date.now(),d=this.X===pa;!this.I&&d&&(this.Y=a);this.I=d;let b=222<a-this.Y;d&&0!==this.state&&(ua="pointer",
b&&this.name&&(qa=this));this.A&&(d=this.A,this.T=!(xa.i>=(d[0]||0)&&ya.i>=(d[1]||0)&&Aa.i>=(this.A[3]||0)&&za.i>=(this.A[2]||0)));this.m&&this.l&&(this.W=(a-this.m)/this.l,a=1<this.W,5===this.state&&a&&(this.state=1))}C(){this.s||this.F&&this.m||1!==this.state||(this.s=!0,this.l&&(this.m=Date.now(),this.state=5),this.gain&&Object.entries(this.gain).map(a=>{let [d,b]=a;U[d].i+=b.i||0;U[d].D+=b.u||0;Da(d,this.x+this.w/2,this.y)}),this.L&&this.L(),setTimeout(()=>{this.s=!1},160))}K(a){if(!this.hidden){var d=
this.v.aa,b=this.y,c=this.g,e=d.width,f=d.height;if(0===this.state||this.B)d=this.v.U;else if(this.T)d=this.v.N;else if(this.s)b+=2,d=this.v.Z;else if(this.m&&this.l&&5===this.state){a.drawImage(this.v.N,this.x,b,this.w,c);let k=Math.min((Date.now()-this.m-160)/(this.l-160),1);f*=k;c*=k}else if(this.I||this.F&&this.m)d=this.v.O;this.I&&this.B&&(d=this.v.O);a.drawImage(d,0,0,e,f,this.x,b,this.w,c)}}}
let V={avatar:{x:172,y:7,w:8,h:8},bone:{x:66,y:7,w:7,h:19},book1:{x:336,y:0,w:12,h:15},book2:{x:348,y:0,w:12,h:15},book3:{x:360,y:0,w:12,h:15},book4:{x:372,y:0,w:12,h:15},book5:{x:384,y:0,w:13,h:13},brain:{x:397,y:0,w:13,h:11},"character 0":{x:33,y:0,w:33,h:54},"character 1":{x:0,y:0,w:33,h:55},claw:{x:321,y:0,w:15,h:13},eye:{x:161,y:7,w:11,h:7},foot:{x:116,y:7,w:9,h:10},horn:{x:99,y:7,w:8,h:13},iconCoin:{x:125,y:7,w:9,h:9},iconHormones:{x:152,y:7,w:9,h:9},iconHorn:{x:143,y:7,w:9,h:9},iconMuted:{x:73,
y:7,w:13,h:9},iconPlaying:{x:86,y:7,w:13,h:9},iconScroll:{x:134,y:7,w:9,h:9},kidney:{x:107,y:7,w:9,h:11},lungs:{x:294,y:0,w:15,h:23},minion:{x:180,y:7,w:7,h:7},note:{x:187,y:7,w:7,h:4},pituitary:{x:194,y:7,w:5,h:5},tail:{x:271,y:0,w:23,h:15},textAlt:{x:66,y:0,w:205,h:7},violin:{x:309,y:0,w:12,h:21}};function La(){var a=Ma;console.log("Sprite Text Init Src: ",V.textAlt);let [d]=aa(V.textAlt);console.log("Sprite Text Init: ",V.textAlt,d.width,d.height);a.g=d}
function Na(a,d){let b=""+d[0]+d[1]+d[2];if(a.m[b])return a.m[b];a.g?.width||console.log("Canvas not defined yet");console.log("GetColorCanvas:",a.g,a.g?.width,a.g?.height);let [c,e]=p(a.g);u(c,e,ja,d);return a.m[b]=c}
function W(a,d,b=0,c=0,e=10,f=.3,k){var g=Ma;d=d.toUpperCase();b*=x;c*=x;e*=x;let m=f*e,q=g.g;k&&(q=Na(g,k));let w=0;d.split("").map((h,r)=>{h=d.charCodeAt(r);if(32==h)w+=2*m;else{if(33==h||46==h)w-=.8*m;43==h&&(h=0);33==h&&(h=1);63==h&&(h=2);45<h&&58>h&&(h-=17);64<h&&91>h&&(h-=62);a.drawImage(q,5*h,0,5,7,b+w,c,e,7*e/5);w+=e+m}});return w}class Oa{constructor(){this.g=document.createElement("canvas");this.m={}}}let Ma=new Oa;
class Pa{constructor(){this.L=[];this.text=this.m="";this.s=document.getElementById("text");document.body.style.fontSize=H/64+"px";let a=t("<div id='footer'></div>");Ba.map(f=>{let k=Ca(U[f.type].icon);f=t(`<div class='${f.name}'><div class='icon'></div><p class='quantity'></p><p class='per_second'></p></div>`);f.querySelector(".icon").append(k);a.append(f);this.L.push(f)});O.append(a);let [d,b]=p(y);this.g=d;d.width=24;d.height=24;document.body.append(d);v(b,0,0,24,24,B,10,void 0,1);b.globalCompositeOperation=
"destination-in";b.translate(12,1);b.rotate(.785);b.fillRect(0,0,Math.ceil(24*.6),Math.ceil(24*.6));let [c,e]=p(this.g);this.G=c;e.globalCompositeOperation="source-over";v(e,0,0,24,24,ha,10,void 0,1);e.translate(12,1);e.rotate(.785);e.strokeStyle=n(B);e.lineWidth=3;e.strokeRect(0,0,Math.ceil(24*.6),Math.ceil(24*.6));e.globalCompositeOperation="destination-in";e.fillRect(0,0,Math.ceil(24*.6),Math.ceil(24*.6))}J(){""!=this.m&&(0,this.m="");let a=qa;this.s.innerHTML="";if(a){let d;a.gain&&(d=Object.entries(a.gain).map(([b,
c])=>(c.i?`<em>+${c.i} <i class=${b}></i>${b}</em>`:"")+(c.u?`<em>+${c.u} <i class=${b}></i>${b}/s</em>`:"")).join(","));this.s.innerHTML=`
        <p>${a.name} <em>${d}</em></p>
        <p>${a.description}
        <p>${a.gain}
      `}}K(a){Ba.map((d,b)=>{var c=25*x;b=(L-7+b*M)*x;let e=(K-7)*x,f=d.i/d.H,k=Math.floor(d.i)+"/"+d.H;d="+"+Math.floor(10*d.D)/10;Q.drawImage(this.g,b,e,c,c);Q.drawImage(this.G,0,24*(1-f),24,24*f,b,e+c*(1-f),c,c*f);b/=x;b+=28;c=1.01*K;b+=W(a,k,b,c,4,.15,ka)/x;b+=W(a,d,b+3,c+2.2,2.5,.1,ka)/x;W(a,"/s",b+3.3,c+3.2,1.7,.5,ka)})}}let X=new AudioContext;X.addEventListener("statechange",a=>{console.log(a)});X.createGain();
function Qa(a){"suspended"===X.state&&X.resume();let d=.5*ta,b=X.createOscillator();b.type="sawtooth";b.frequency.setValueAtTime(a,X.currentTime);a=X.createGain();a.gain.setValueAtTime(0,X.currentTime);a.gain.linearRampToValueAtTime(d,X.currentTime+.05);a.gain.exponentialRampToValueAtTime(.001,X.currentTime+1.5);b.connect(a);a.connect(X.destination);b.start(X.currentTime);b.stop(X.currentTime+1.5)}
let Y=1*H/24/x,Z=J/x,Ra=(J+4.1*I/24)/x,Sa=(J+11*I/24)/x,Ta=[{name:"eye",description:"the final evolution",state:0,A:{[0]:100,[2]:50,[3]:4},gain:{},F:!0,o:{x:Y+25,y:Z+5,w:19,j:[V.eye]}},{name:"pituitary",description:"starts hormone production.",state:1,A:{[0]:10},gain:{[0]:{u:.5}},F:!0,o:{x:Y+30,y:Z+50,w:10,j:[V.pituitary]}},{name:"kidney",description:"starts hormone production.",state:0,A:{[0]:10},gain:{[0]:{u:.5}},F:!0,o:{x:Y+5,y:Z+72,w:16,j:[V.kidney]}},{name:"brain",description:"The root of all evil",
l:1E3,state:1,gain:{[0]:{i:10}},o:{x:Y+23,y:Z+27,w:23,j:[V.brain]}},{name:"lungs",description:"Throat organs",l:1E3,state:0,gain:{[0]:{i:10}},o:{x:Y+24,y:Z+68,w:24,j:[V.lungs]}},{name:"bones",description:"Growth spurt",l:1E3,state:0,gain:{[0]:{i:10}},o:{x:Y+53,y:Z+74,w:11.5,j:[V.bone]}},{name:"claws",description:"null",l:2E3,state:0,gain:{[2]:{u:1}},C(){},o:{x:Y+5,y:Z+49,w:20,M:17,j:[V.claw]}},{name:"horns",description:"null",l:2E3,state:0,gain:{[2]:{u:1}},C(){},o:{x:Y+4,y:Z+8,w:14,M:20,j:[V.horn]}},
{name:"hooves",description:"null",l:2E3,state:0,gain:{[2]:{u:1}},o:{x:Y+4,y:Z+129,w:17,M:15,j:[V.foot]}},{name:"tail",description:"null",l:2E3,state:0,gain:{[2]:{u:1}},o:{x:Y+4,y:Z+99,w:39,j:[V.tail]}}],Ua=[],Va=Array(6).fill(6).map(()=>l(5));for(let a=0;6>a;a++){let d=a/6;for(let b=0;6>b;b++){let c=la[a];Ua.push({state:1,B:Va[b]!==a,C(){Qa(c);T.map(e=>{e?.data?.c==b&&(e.B=!0)});this.B=!1},o:{id:"note",x:213+b/6*70,y:Ra+(-1+31*d),w:9,j:[V.note],data:{c:b,r:a,ba:c}}})}}
let Wa=[{name:"violin",description:"null",l:1800,state:1,gain:{[2]:{u:1}},C(){let a=[],d=T.filter(b=>b.id.match("note")&&!b.B);for(let b=0;6>b;b++){let c=d.find(e=>e?.data?.c==b);c&&a.push(c)}new Ea(300,6,b=>{(b=a[6-b])&&b.C()})},o:{x:180,y:Ra,w:25,j:[V.violin]}},...Ua],Xa=[{name:"codex gigas",description:"null",l:2E3,state:1,gain:{[3]:{i:1}},o:{x:183,y:Sa,w:17,j:[V.book1]}},{name:"the black arts",description:"null",l:2E3,state:1,gain:{[3]:{i:1}},o:{x:210,y:Sa,w:17,j:[V.book2]}},{name:"Dantes Inferno",
description:"null",l:2E3,state:1,gain:{[3]:{i:1}},o:{x:237,y:Sa,w:17,j:[V.book3]}},{name:"chicken soup for the teenage devil",description:"null",l:2E3,state:1,gain:{[3]:{i:1}},o:{x:263,y:Sa,w:19,j:[V.book5]}},{state:1,C(){ta=1-ta;this.v=this.S.next()},o:{x:276,y:10,w:10,j:[V.iconPlaying,V.iconMuted]}}],Ya=[...Ta,...Wa,...Xa],Za=[{x:(22*H/24-4)/x,y:(J+20)/x,w:10,j:[V.minion]},{x:L+0*M,y:K,w:10,j:[V.iconHormones]},{x:L+M,y:K,w:10,j:[V.iconHorn]},{x:L+2*M,y:K,w:10,j:[V.iconCoin]},{x:L+3*M,y:K,w:10,j:[V.iconScroll]},
{x:98,y:1.5*J/x,w:60,j:[V["character 0"],V["character 1"]],$:2E3}];
function $a(){let [a,d]=p(y);a.id="page-background";document.body.prepend(a);v(d,0,0,F,G,B,1);let [b,c]=p(P);b.id="background";c.scale(E,E);O.prepend(b);v(c,0,0,H,I,ba);var e=1*H/24,f=5.5*H/24,k=16*I/24;v(c,e,J,f,k,B,6);v(c,e,J,f,k,B,20,2);v(c,14*H/24,J,9*H/24,2.75*I/24,B,5);f=14*H/24;k=J+3.5*I/24;var g=5.75*I/24;e=3*x;v(c,f,k,9*H/24,g,B,5);W(c,"THE BAND",1.22*f/x,.9*(k+g)/x,5,.84,ia);g=30*x;for(var m=1;7>m;m++)c.fillStyle=n(ca),c.fillRect(f+37*x,k+(9+m*g/6),67*x,x);f=14*H/24;k=J+10*I/24;g=9*H/24;
m=5.75*I/24;let q=f+e,w=k+e,h=g-2*e;e=m-2*e;v(c,f,k,g,m,B,5);v(c,q,w,h,e,fa,20,2);W(c,"The Library",1.05*f/x,.91*(k+m)/x,5,.81,ia);e=7*H/24;f=6.5*H/24;k=13*I/24;g=2*x;v(c,e+g,J+g,f-2*g,k-2*g,ea,12);v(c,e+g,J+k-6*g,f-2*g,5.1*g,fa,20);v(c,e,J,f,k,B,5,5)}z.onload=ab;console.log("Load Spritesheet",z);
function ab(){console.log("On Loaded Spritesheet");Q.fillStyle="blue";Q.fillRect(0,0,100,100);Q.drawImage(z,0,0,100,100,0,0,100,100);La();$a();console.log("Rendered Background");let a=new Pa;Za.map(b=>va.push(new Fa(b)));Ya.map(b=>T.push(new Ka(b)));document.addEventListener("mousemove",b=>{ra=b.x;sa=b.y});console.log("After Initialized");document.getElementById("loading")?.remove();let d=document.getElementById("start");(function(){console.log("Start Function");d.remove();na.fillStyle="red";new Ea(100,
1,c=>{na.clearRect(0,0,N.width,N.height*(1-c/1));1==c&&N.remove()});window.addEventListener("click",()=>{T.find(c=>c.I)?.C()});let b=0;(function f(e){let k=e-b;20<=k&&(b=e-k%20,document.body.style.cursor=ua,ua="default",Q.clearRect(0,0,H,I),a.J(),a.K(Q),va.map(g=>g.K(Q)),Ba.map(g=>{g.i+=g.D*k/1E3;g.i>g.H&&(g.i=g.H)}),T.map(g=>{g.J();g.K(Q)}),wa.map(g=>{g.J(k)}),Ia());requestAnimationFrame(f)})(0)})()};
